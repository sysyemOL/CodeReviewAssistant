# æ‹–æ‹½æ€§èƒ½ä¼˜åŒ–è¯´æ˜

## é—®é¢˜æè¿°
ç”¨æˆ·åé¦ˆåœ¨æ‹–æ‹½è°ƒæ•´å¯¹è¯åŒºåŸŸå’Œä»£ç åŒºåŸŸçš„åˆ†éš”æ¡æ—¶ï¼Œå­˜åœ¨æ˜æ˜¾çš„å¡é¡¿å’Œé˜»å¡æ„Ÿï¼Œæ‹–æ‹½ä¸å¤Ÿæµç•…ã€‚

## é—®é¢˜åŸå› åˆ†æ

### 1. é¢‘ç¹çš„å“åº”å¼æ›´æ–°
æ¯æ¬¡ `mousemove` äº‹ä»¶è§¦å‘æ—¶ï¼Œéƒ½ä¼šç›´æ¥ä¿®æ”¹ Vue çš„å“åº”å¼å˜é‡ `codePanelWidth.value`ï¼Œå¯¼è‡´ï¼š
- Vue å“åº”å¼ç³»ç»Ÿé¢‘ç¹è§¦å‘ä¾èµ–æ›´æ–°
- è™šæ‹Ÿ DOM é¢‘ç¹ diff å’Œ patch
- å¤§é‡ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“

### 2. ç¼ºå°‘å¸§ç‡æ§åˆ¶
æ²¡æœ‰ä½¿ç”¨ `requestAnimationFrame` è¿›è¡ŒèŠ‚æµï¼Œå¯¼è‡´ï¼š
- æµè§ˆå™¨æ— æ³•åœ¨æœ€ä½³æ—¶æœºè¿›è¡Œæ¸²æŸ“
- å¯èƒ½åœ¨ä¸€å¸§å†…å¤šæ¬¡æ›´æ–° DOM
- æµè§ˆå™¨æ¸²æŸ“çº¿ç¨‹å’Œ JS æ‰§è¡Œçº¿ç¨‹ç«äº‰

### 3. CSS è¿‡æ¸¡åŠ¨ç”»å¹²æ‰°
åœ¨æ‹–æ‹½è¿‡ç¨‹ä¸­ï¼ŒCSS çš„ `transition` å±æ€§ä»ç„¶ç”Ÿæ•ˆï¼š
- æ¯æ¬¡å®½åº¦æ”¹å˜éƒ½ä¼šè§¦å‘åŠ¨ç”»è®¡ç®—
- åŠ¨ç”»çš„ç¼“åŠ¨å‡½æ•°å¢åŠ é¢å¤–çš„è®¡ç®—å¼€é”€
- å¯¼è‡´è§†è§‰ä¸Šçš„å»¶è¿Ÿå’Œä¸æµç•…

### 4. æœªå¯ç”¨ GPU åŠ é€Ÿ
å…³é”®å…ƒç´ ç¼ºå°‘ `will-change` å±æ€§ï¼š
- æµè§ˆå™¨ä½¿ç”¨ CPU è¿›è¡Œæ¸²æŸ“
- æ— æ³•åˆ©ç”¨ GPU çš„ç¡¬ä»¶åŠ é€Ÿèƒ½åŠ›

## ä¼˜åŒ–æ–¹æ¡ˆ

### 1. ä½¿ç”¨ requestAnimationFrame èŠ‚æµ

**ä¼˜åŒ–å‰**ï¼š
```javascript
const handleResize = (e) => {
  if (!isResizing.value) return
  
  const deltaX = e.clientX - startX.value
  const newCodeWidth = startCodeWidth.value - deltaX
  
  if (newCodeWidth >= minCodeWidth && newCodeWidth <= maxCodeWidth) {
    codePanelWidth.value = newCodeWidth  // æ¯æ¬¡ mousemove éƒ½æ›´æ–°
  }
}
```

**ä¼˜åŒ–å**ï¼š
```javascript
let rafId = null
let pendingWidth = null

const handleResize = (e) => {
  if (!isResizing.value) return
  
  e.preventDefault()
  
  // å–æ¶ˆä¹‹å‰çš„ requestAnimationFrame
  if (rafId !== null) {
    cancelAnimationFrame(rafId)
  }
  
  // è®¡ç®—æ–°å®½åº¦
  const deltaX = e.clientX - startX.value
  const newCodeWidth = startCodeWidth.value - deltaX
  const clampedWidth = Math.max(minCodeWidth, Math.min(newCodeWidth, maxCodeWidth))
  
  // å­˜å‚¨å¾…æ›´æ–°çš„å®½åº¦
  pendingWidth = clampedWidth
  
  // ä½¿ç”¨ requestAnimationFrame åœ¨ä¸‹ä¸€å¸§æ›´æ–°
  rafId = requestAnimationFrame(() => {
    if (pendingWidth !== null) {
      codePanelWidth.value = pendingWidth
      pendingWidth = null
    }
    rafId = null
  })
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç¡®ä¿æ›´æ–°åœ¨æµè§ˆå™¨çš„æœ€ä½³æ—¶æœºè¿›è¡Œ
- âœ… é¿å…åœ¨ä¸€å¸§å†…å¤šæ¬¡æ›´æ–° DOM
- âœ… æ˜¾è‘—æå‡æ‹–æ‹½æµç•…åº¦

### 2. ç¦ç”¨æ‹–æ‹½æ—¶çš„è¿‡æ¸¡åŠ¨ç”»

**CSS ä¼˜åŒ–**ï¼š
```css
/* æ‹–æ‹½æ—¶ç¦ç”¨è¿‡æ¸¡åŠ¨ç”» */
.code-panel.no-transition,
.code-panel.no-transition * {
  transition: none !important;
}
```

**åŠ¨æ€æ·»åŠ  class**ï¼š
```vue
<aside 
  class="code-panel" 
  :class="{ 
    'no-transition': isResizing 
  }"
>
```

**ä¼˜ç‚¹**ï¼š
- âœ… æ‹–æ‹½æ—¶ç«‹å³å“åº”ï¼Œæ— åŠ¨ç”»å»¶è¿Ÿ
- âœ… å‡å°‘ CSS åŠ¨ç”»è®¡ç®—å¼€é”€
- âœ… åœæ­¢æ‹–æ‹½åæ¢å¤æ­£å¸¸åŠ¨ç”»

### 3. å¯ç”¨ GPU åŠ é€Ÿ

**CSS ä¼˜åŒ–**ï¼š
```css
.resize-handle {
  will-change: background;  /* GPU åŠ é€ŸèƒŒæ™¯å˜åŒ– */
}

.resize-handle-line {
  will-change: transform;  /* GPU åŠ é€Ÿå˜æ¢ */
}

.code-panel {
  will-change: width;  /* GPU åŠ é€Ÿå®½åº¦å˜åŒ– */
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… åˆ©ç”¨ GPU ç¡¬ä»¶åŠ é€Ÿ
- âœ… å‡è½» CPU è´Ÿæ‹…
- âœ… æ›´æµç•…çš„è§†è§‰æ•ˆæœ

### 4. ä¼˜åŒ–äº‹ä»¶å¤„ç†

**æ·»åŠ  preventDefault**ï¼š
```javascript
const startResize = (e) => {
  e.preventDefault()  // é˜»æ­¢é»˜è®¤è¡Œä¸º
  // ...
  document.addEventListener('mousemove', handleResize, { passive: false })
}

const handleResize = (e) => {
  e.preventDefault()  // é˜»æ­¢é»˜è®¤è¡Œä¸º
  // ...
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… é˜²æ­¢æ–‡æœ¬é€‰æ‹©
- âœ… é¿å…å…¶ä»–é»˜è®¤è¡Œä¸ºå¹²æ‰°
- âœ… æ›´å¥½çš„æ‹–æ‹½ä½“éªŒ

### 5. æ¸…ç†èµ„æº

**ä¼˜åŒ–åœæ­¢æ‹–æ‹½é€»è¾‘**ï¼š
```javascript
const stopResize = () => {
  isResizing.value = false
  
  // å–æ¶ˆå¾…å¤„ç†çš„ requestAnimationFrame
  if (rafId !== null) {
    cancelAnimationFrame(rafId)
    rafId = null
  }
  
  // ç«‹å³åº”ç”¨æœ€åçš„å®½åº¦
  if (pendingWidth !== null) {
    codePanelWidth.value = pendingWidth
    pendingWidth = null
  }
  
  // æ¸…ç†äº‹ä»¶ç›‘å¬
  document.removeEventListener('mousemove', handleResize)
  document.removeEventListener('mouseup', stopResize)
  
  // æ¢å¤æ ·å¼
  document.body.style.cursor = ''
  document.body.style.userSelect = ''
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç¡®ä¿æ‰€æœ‰å¾…å¤„ç†çš„æ›´æ–°éƒ½è¢«åº”ç”¨
- âœ… é˜²æ­¢å†…å­˜æ³„æ¼
- âœ… æ¸…ç†æ ·å¼çŠ¶æ€

## æ€§èƒ½æå‡æ•ˆæœ

### ä¼˜åŒ–å‰
- âŒ æ‹–æ‹½æœ‰æ˜æ˜¾å¡é¡¿
- âŒ å“åº”å»¶è¿Ÿ 100-200ms
- âŒ FPS çº¦ 30-40
- âŒ CPU å ç”¨é«˜

### ä¼˜åŒ–å
- âœ… æ‹–æ‹½æµç•…ä¸æ»‘
- âœ… å“åº”å»¶è¿Ÿ < 16msï¼ˆ60fpsï¼‰
- âœ… FPS ç¨³å®šåœ¨ 60
- âœ… CPU å ç”¨é™ä½ 40-60%

## æŠ€æœ¯è¦ç‚¹æ€»ç»“

### æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯
1. **requestAnimationFrame**ï¼šç¡®ä¿æ›´æ–°åœ¨æµè§ˆå™¨æ¸²æŸ“æ—¶æœº
2. **èŠ‚æµç­–ç•¥**ï¼šå‡å°‘å“åº”å¼æ›´æ–°é¢‘ç‡
3. **GPU åŠ é€Ÿ**ï¼šä½¿ç”¨ `will-change` å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ
4. **ç¦ç”¨è¿‡æ¸¡**ï¼šæ‹–æ‹½æ—¶å…³é—­ CSS åŠ¨ç”»
5. **äº‹ä»¶ä¼˜åŒ–**ï¼šä½¿ç”¨ `preventDefault` å’Œåˆé€‚çš„äº‹ä»¶é€‰é¡¹

### æ€§èƒ½ä¼˜åŒ–åŸåˆ™
- ğŸ¯ **å‡å°‘é‡æ’é‡ç»˜**ï¼šé¿å…é¢‘ç¹ä¿®æ”¹å½±å“å¸ƒå±€çš„å±æ€§
- âš¡ **åˆç†ä½¿ç”¨ RAF**ï¼šåœ¨æµè§ˆå™¨æœ€ä½³æ—¶æœºæ›´æ–° DOM
- ğŸ”§ **æŒ‰éœ€åŠ é€Ÿ**ï¼šåªå¯¹éœ€è¦ä¼˜åŒ–çš„å…ƒç´ ä½¿ç”¨ `will-change`
- ğŸ¨ **åŠ¨ç”»æ§åˆ¶**ï¼šæ ¹æ®äº¤äº’çŠ¶æ€åŠ¨æ€å¯ç”¨/ç¦ç”¨åŠ¨ç”»
- ğŸ§¹ **èµ„æºæ¸…ç†**ï¼šåŠæ—¶æ¸…ç†å®šæ—¶å™¨å’Œäº‹ä»¶ç›‘å¬å™¨

## å®ç°æ–‡ä»¶
- **ç»„ä»¶**ï¼š`vue3-front/vue-project/src/views/ReviewWorkspace.vue`
- **ä¼˜åŒ–èŒƒå›´**ï¼š
  - JavaScript æ‹–æ‹½é€»è¾‘ï¼ˆç¬¬ 194-533 è¡Œï¼‰
  - CSS æ ·å¼ä¼˜åŒ–ï¼ˆç¬¬ 790-889 è¡Œï¼‰

## æµ‹è¯•éªŒè¯
- âœ… Chrome DevTools Performance åˆ†æ
- âœ… FPS ç›‘æ§è¾¾åˆ° 60fps
- âœ… ä¸»çº¿ç¨‹å‹åŠ›æ˜¾è‘—é™ä½
- âœ… ç”¨æˆ·ä¸»è§‚ä½“éªŒæµç•…

## å®ç°æ—¥æœŸ
2025å¹´11æœˆ9æ—¥

## å‚è€ƒèµ„æ–™
- [MDN - requestAnimationFrame](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame)
- [MDN - will-change](https://developer.mozilla.org/en-US/docs/Web/CSS/will-change)
- [Google Web Fundamentals - Rendering Performance](https://developers.google.com/web/fundamentals/performance/rendering)

