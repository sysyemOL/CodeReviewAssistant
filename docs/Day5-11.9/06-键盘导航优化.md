# 键盘导航优化 - 文件Tab切换

## ✅ 已完成优化

### 问题描述
用户使用Tab键时，焦点会跳到文件Tab的关闭按钮(X)和其他编辑器按钮，导致导航混乱。

### 解决方案

#### 1. 优化Tab焦点顺序
**文件Tab关闭按钮**:
- 设置 `tabindex="-1"` 
- ❌ 不被Tab键聚焦
- ✅ 仍可点击关闭

**滚动按钮**:
- 设置 `tabindex="-1"`
- ❌ 不被Tab键聚焦
- ✅ 仍可点击使用

---

### 2. 完整的键盘快捷键

#### 文件Tab导航
| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `Tab` | 聚焦文件Tab | 在页面元素间导航 |
| `←` `→` | 切换文件Tab | 在当前聚焦的Tab上按箭头键 |
| `Enter` | 激活Tab | 切换到选中的文件 |
| `空格` | 激活Tab | 切换到选中的文件 |
| `Delete` | 关闭文件 | 关闭当前聚焦的文件 |
| `Backspace` | 关闭文件 | 同Delete |
| `Ctrl+1-9` | 跳转到文件 | 直接跳到第N个文件 |
| `Ctrl+W` | 关闭当前文件 | 关闭当前激活的文件 |

---

### 3. 使用方法

#### 方式1：Tab键 + 箭头键（推荐）✨
```
1. 按 Tab 键聚焦到第一个文件Tab
2. 按 ← 或 → 在文件Tab之间快速切换
3. 按 Delete 关闭不需要的文件
```

**优点**:
- 🚀 最快的导航方式
- ⌨️ 纯键盘操作
- 🔄 自动循环切换

#### 方式2：Tab键顺序导航（标准）
```
1. 按 Tab 键在页面元素间导航
   - 文件Tab 1
   - 文件Tab 2
   - 主题选择器
   - 其他按钮...
2. 按 Enter 或空格激活选中的Tab
```

**说明**: Tab键会按照HTML标准顺序在所有可聚焦元素间切换

#### 方式3：快捷键（最快）⚡
```
Ctrl+1  → 第1个文件
Ctrl+2  → 第2个文件
Ctrl+W  → 关闭当前文件
```

---

### 4. 设计理念

#### 符合Web标准
Tab键导航遵循HTML标准：
- Tab键在**所有可聚焦元素**间切换
- 包括：链接、按钮、表单、Tab等
- 这是浏览器的默认行为

#### 优化的导航体验
我们做了以下优化：
1. ✅ 移除关闭按钮的Tab焦点
2. ✅ 添加箭头键快速切换
3. ✅ 添加Delete键关闭文件
4. ✅ 添加Ctrl+数字快速跳转
5. ✅ 清晰的焦点视觉反馈

---

### 5. 焦点视觉效果

#### 聚焦状态
当文件Tab被Tab键聚焦时：
```css
/* 蓝色内边框 */
.file-tab:focus {
  box-shadow: inset 0 0 0 2px #409eff;
}

/* 蓝色外边框（仅键盘导航） */
.file-tab:focus-visible {
  outline: 2px solid #409eff;
}
```

**效果**: 
- 🔵 蓝色高亮边框
- 📍 清晰的焦点指示
- ✨ 平滑过渡动画

---

### 6. 焦点管理

#### 删除文件后的焦点
删除文件时，焦点自动移到相邻的文件：

```javascript
删除第2个文件 (共3个)
├─ 文件1
├─ 文件2 [删除] ← 焦点在这里
└─ 文件3 [获得焦点] ← 焦点移到这里

删除最后一个文件 (共3个)
├─ 文件1
├─ 文件2 [获得焦点] ← 焦点移到前一个
└─ 文件3 [删除] ← 焦点在这里
```

**优点**: 删除后不需要重新定位焦点

---

### 7. Tab顺序说明

**当前的Tab顺序（标准HTML行为）**:
```
Tab键按顺序聚焦：
1. 文件Tab 1
2. 文件Tab 2
3. 文件Tab 3
4. 主题选择器下拉菜单
5. 背景上传按钮
6. 目录折叠按钮
7. ... 其他按钮
```

**这是正常的Web行为！** ✅

如果您想**只在文件Tab间切换**，请使用：
- ← → 箭头键（推荐）
- Ctrl+1-9 数字键（快捷）

---

### 8. 无障碍支持

#### 语义化标签
```html
<div role="tablist">          <!-- Tab列表 -->
  <div 
    role="tab"                 <!-- Tab项 -->
    tabindex="0"               <!-- 可聚焦 -->
    aria-selected="true"       <!-- 选中状态 -->
  >
    <span>文件名</span>
    <button 
      role="button"            <!-- 关闭按钮 -->
      tabindex="-1"            <!-- 不被Tab聚焦 -->
      aria-label="关闭文件"    <!-- 屏幕阅读器 -->
    />
  </div>
</div>
```

#### 屏幕阅读器支持
- ✅ `role="tab"` - 标识为Tab
- ✅ `role="tablist"` - 标识为Tab列表
- ✅ `aria-selected` - 指示选中状态
- ✅ `aria-label` - 提供文字描述

---

### 9. 最佳实践

#### ✅ 推荐做法
```
目标：快速在文件间切换
方法：
  1. Tab键聚焦到任意文件Tab
  2. ← → 箭头键快速切换
  3. Delete键关闭不需要的文件
```

#### ✅ 快捷键高手
```
目标：极速操作
方法：
  Ctrl+1  → 跳到第1个文件
  Ctrl+2  → 跳到第2个文件
  Ctrl+W  → 关闭当前文件
  （无需Tab键）
```

#### ⚠️ 不推荐
```
❌ 只用Tab键在文件间导航
原因：Tab键会遍历所有可聚焦元素（按钮、输入框等）
```

---

### 10. 对比其他编辑器

#### VS Code
- Tab键聚焦到文件Tab区域
- ← → 箭头键切换文件
- Ctrl+Tab 切换最近文件
- Ctrl+W 关闭文件

#### Chrome浏览器
- Tab键遍历所有可聚焦元素
- Ctrl+Tab 切换标签页
- Ctrl+W 关闭标签页

#### 我们的实现 ✅
- ✅ Tab键标准HTML行为（遍历所有元素）
- ✅ ← → 箭头键切换文件（类似VS Code）
- ✅ Ctrl+1-9 快速跳转
- ✅ Delete键关闭文件
- ✅ Ctrl+W 关闭当前文件（类似浏览器）

**结论**: 结合了标准Web行为和IDE最佳实践！

---

### 11. 常见问题

#### Q: 为什么Tab键还是会跳到其他按钮？
**A**: 这是标准HTML行为，Tab键会在所有可聚焦元素间切换。如果只想在文件Tab间切换，请使用 **← → 箭头键**。

#### Q: 怎样才能不让Tab键跳到主题选择器？
**A**: 使用箭头键或Ctrl+数字键，而不是Tab键。Tab键的设计就是要遍历所有元素。

#### Q: 有没有更快的方法切换文件？
**A**: 有！使用快捷键：
- `Ctrl+1` - 第1个文件
- `Ctrl+2` - 第2个文件
- 等等...

#### Q: 怎么用键盘关闭文件？
**A**: 三种方式：
1. Tab到文件Tab，按 `Delete`
2. 激活文件后，按 `Ctrl+W`
3. 点击关闭按钮（需要鼠标）

---

### 12. 未来可能的优化

- [ ] Ctrl+Tab 在文件间循环切换（类似浏览器）
- [ ] Alt+数字键 跳转到第N个文件
- [ ] 自定义Tab键行为（设置面板）
- [ ] Tab组管理（分组显示文件）

---

## 📊 总结

### 当前状态 ✅
- ✅ Tab键符合Web标准行为
- ✅ 箭头键快速切换文件
- ✅ 快捷键直接跳转
- ✅ 关闭按钮不被Tab聚焦
- ✅ Delete键快速关闭
- ✅ 清晰的焦点视觉反馈
- ✅ 完善的无障碍支持

### 用户体验 🎯
- 🚀 多种导航方式可选
- ⌨️ 纯键盘操作友好
- 🎨 清晰的视觉反馈
- ♿ 无障碍用户友好

---

**建议**: 使用 **← → 箭头键** 在文件Tab间快速切换！ 🚀

---

*最后更新: 2024.11.9*

