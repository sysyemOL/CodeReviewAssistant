# 自动会话标题功能说明

## 功能概述
自动使用用户在会话中的第一次发言作为会话标题，提升用户体验。

## 功能特性
1. **自动生成标题**：当用户首次在"新对话"中发送消息时，自动将会话标题更新为用户消息的内容
2. **长度限制**：标题最长显示6个字符
3. **省略号处理**：超过6个字符时自动添加"..."省略号
4. **实时更新**：标题在AI响应完成后立即在前端更新显示

## 实现细节

### 后端实现 (`python-back/app/api/v1/chat.py`)
在保存用户消息后，检查会话标题：
```python
# 自动设置会话标题（如果是默认标题）
session = db.query(SessionModel).filter(SessionModel.session_id == session_id).first()
if session and session.title == "新对话":
    # 使用用户消息的前6个字符作为标题
    title = user_message.strip()[:6]
    if len(user_message.strip()) > 6:
        title += "..."
    session.title = title
    db.commit()
```

### 前端实现 (`vue3-front/vue-project/src/views/ReviewWorkspace.vue`)
在AI响应完成后刷新会话信息：
```javascript
onDone: async (data) => {
  messageStore.endStreamingMessage()
  scrollToBottom()
  
  // 刷新当前会话以更新标题
  try {
    const updatedSession = await sessionAPI.getSession(sessionStore.currentSessionId)
    const index = sessionStore.sessions.findIndex(s => s.session_id === sessionStore.currentSessionId)
    if (index !== -1) {
      sessionStore.sessions[index] = updatedSession
    }
  } catch (error) {
    console.error('刷新会话失败:', error)
  }
}
```

## 测试案例

### 测试1：长标题（超过6个字符）
- **输入**：`这是一个测试消息`
- **预期输出**：`这是一个测试...`
- **结果**：✅ 通过

### 测试2：短标题（不超过6个字符）
- **输入**：`你好`
- **预期输出**：`你好`
- **结果**：✅ 通过

### 测试3：恰好6个字符
- **输入**：`大大大大大大`
- **预期输出**：`大大大大大大`（无省略号）

## 边界情况处理
1. ✅ 空白字符：使用 `strip()` 去除首尾空白
2. ✅ 超长消息：正确截取前6个字符并添加省略号
3. ✅ 中文字符：Python字符串切片正确处理中文（基于字符数而非字节数）
4. ✅ 多次发言：只在首次发言（标题为"新对话"时）更新标题

## 用户体验
- 🎯 自动化：无需手动设置标题
- 📝 语义化：标题直接反映对话内容
- 🔄 实时更新：UI立即响应标题变化
- 💡 直观明了：通过省略号提示有更多内容

## 实现日期
2025年11月9日

